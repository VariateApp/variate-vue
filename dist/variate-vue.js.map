{"version":3,"file":"variate-vue.js","sources":["../src/config/console.js","../src/lang/version.js","../src/lang/debug.js","../src/variate.js","../src/helpers.js","../src/index.js"],"sourcesContent":["export const name = 'Variate Vue';\n\nexport const styles = {\n    brand: \"background: rgba(143, 127, 224, 1); color: white; font-weight: 500; border-radius: 3px 0 0 3px; padding: 1px 2px;\",\n    error: \"background: #e17055; color: white; font-weight: 500; border-radius: 3px 0 0 3px; padding: 1px 2px;\",\n    warning: \"background: #fdcb6e; color: white; font-weight: 500; border-radius: 3px 0 0 3px; padding: 1px 2px;\",\n    type: \"background: #424242; color: white; font-weight: 400; padding: 1px 2px; border-radius: 0 3px 3px 0;\",\n    message: \"background: transparent; font-weight: 400;\"\n}\n","import { name, styles } from '../config/console';\n\nexport default {\n    show: function() {\n        console.log(\n            `%c ${name} %c __VERSION__ `,\n            styles.brand,\n            styles.type\n        );\n    },\n}\n","// Components\nexport const LOAD_COMPONENT= `[COMPONENT] %s`;\nexport const LOAD_COMPONENT_EXPERIMENTS = `Running experiments:`;\n","import Variate from '@variate/engine';\nimport version from './lang/version';\nimport * as debug from './lang/debug';\n\nexport function install(Vue, options) {\n    options.debug && version.show();\n    // 3. inject some component options\n    Vue.mixin({\n        props: {\n            variateId: {\n                type: String,\n                default: () => null\n            }\n        },\n        computed: {\n            variateComponentName() {\n                return this.variateId || this.$options._componentTag;\n            },\n            variateMainBucket() {\n                return this.$variate.getMainTrafficBucket();\n            },\n            variateComponent() {\n                if (typeof this.$variate.components[this.variateComponentName] !== 'undefined') {\n                    return this.$variate.components[this.variateComponentName];\n                }\n\n                return {};\n            },\n            variateBucket() {\n                return this.variateComponent.bucket;\n            },\n            variateExperiments() {\n                return this.variateComponent.experiments;\n            },\n            variateAttributes() {\n                return this.variateComponent.attributes || {};\n            },\n        },\n        created() {\n            if (typeof this.variateExperiments !== 'undefined') {\n                options.debug && console.groupCollapsed(debug.LOAD_COMPONENT, this.variateComponentName);\n                options.debug && console.log(debug.LOAD_COMPONENT_EXPERIMENTS);\n                options.debug && console.log(this.variateExperiments);\n                options.debug && console.groupEnd();\n            }\n        },\n    });\n\n    Vue.prototype.$variate = new Variate(options);\n}\n","export const mapStyles = normalizeNamespace((namespace, map) => {\n    let styles = namespace || 'styles';\n    let response = {};\n\n    if(Array.isArray(map)) {\n        response[styles] = normalizeMap(map).map(({ key, val }) => {\n            const property = key.split(/(?=[A-Z])/).map((value) => value.toLowerCase()).join('-');\n            return `${property}: ${val}`;\n        });\n\n        return response;\n    }\n\n    response[styles] =  function() {\n        return normalizeMap(map).map(({ key, val }) => {\n            const property = key.split(/(?=[A-Z])/).map((value) => value.toLowerCase()).join('-');\n            return `${property}: ${val.replace(/%s/g, () => this[key] || key )}`;\n        }).join('; ');\n    };\n\n    return response;\n});\n\n/**\n *\n * @param attributes\n */\nexport const mapAttributes = (attributes) => {\n    let computed = {};\n\n    normalizeMap(attributes).forEach(({ key, val }) => {\n        computed[key] = function() {\n            if(!this.variateAttributes) {\n                return null;\n            }\n\n            return this.variateAttributes[key] || this.variateAttributes[val];\n        };\n    });\n\n    return computed;\n};\n\n/**\n * Return a function expect two param contains namespace and map. it will normalize the namespace and then the param's function will handle the new namespace and the map.\n * @param {Function} fn\n * @return {Function}\n */\nfunction normalizeNamespace (fn) {\n    return (namespace, map) => {\n        if (typeof namespace !== 'string') {\n            map = namespace\n            namespace = ''\n        }\n\n        return fn(namespace, map)\n    }\n}\n\n/**\n * Normalize the map\n * normalizeMap([1, 2, 3]) => [ { key: 1, val: 1 }, { key: 2, val: 2 }, { key: 3, val: 3 } ]\n * normalizeMap({a: 1, b: 2, c: 3}) => [ { key: 'a', val: 1 }, { key: 'b', val: 2 }, { key: 'c', val: 3 } ]\n * @param {Array|Object} map\n * @return {Object}\n */\nfunction normalizeMap(map) {\n    return Array.isArray(map)\n        ? map.map(key => ({ key, val: key }))\n        : Object.keys(map).map(key => ({ key, val: map[key] }));\n}\n\nexport default mapAttributes;\n","import { install } from './variate';\nimport { mapAttributes, mapStyles } from './helpers';\n\nexport {\n    mapAttributes,\n    mapStyles\n}\n\nexport default {\n    install,\n    mapAttributes,\n    mapStyles,\n}\n"],"names":["name","styles","brand","error","warning","type","message","show","console","log","LOAD_COMPONENT","LOAD_COMPONENT_EXPERIMENTS","install","Vue","options","debug","version","mixin","props","variateId","String","default","computed","variateComponentName","$options","_componentTag","variateMainBucket","$variate","getMainTrafficBucket","variateComponent","components","variateBucket","bucket","variateExperiments","experiments","variateAttributes","attributes","created","groupCollapsed","groupEnd","prototype","Variate","mapStyles","normalizeNamespace","namespace","map","response","Array","isArray","normalizeMap","key","val","property","split","value","toLowerCase","join","replace","mapAttributes","forEach","fn","Object","keys"],"mappings":"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"}